#!/bin/bash

# Create or update tags for given release X.Y.Z
# Tags are created/updated for:
# - vX (major)
# - vX.Y (major.minor)
# - vX.Y.Z (major.minor.patch)

VERSION="$1"
if [ -z "$VERSION" ]; then
  echo "Usage: $0 X.Y.Z"
  exit 1
fi

git fetch --tags
echo "Release version: $VERSION"
MAJOR=$(echo "$VERSION" | cut -d. -f1)
MINOR=$(echo "$VERSION" | cut -d. -f2)
PATCH=$(echo "$VERSION" | cut -d. -f3)
if [ -z "$MAJOR" ] || [ -z "$MINOR" ] || [ -z "$PATCH" ]; then
  echo "Invalid version: $VERSION"
  exit 1
fi
TAGS=("v$MAJOR" "v$MAJOR.$MINOR" "v$MAJOR.$MINOR.$PATCH")
for TAG in "${TAGS[@]}"; do
  if git rev-parse "$TAG" >/dev/null 2>&1; then
    echo "Updating tag $TAG"
    git tag -f "$TAG"
  else
    echo "Creating tag $TAG"
    git tag "$TAG"
  fi
done

echo "Pushing tags to origin"
git push origin --tags --force
